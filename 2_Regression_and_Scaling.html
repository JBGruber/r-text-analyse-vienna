<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.427">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Johannes B. Gruber">
<meta name="dcterms.date" content="2023-07-06">

<title>Workshop Automated Content Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="2_Regression_and_Scaling_files/libs/clipboard/clipboard.min.js"></script>
<script src="2_Regression_and_Scaling_files/libs/quarto-html/quarto.js"></script>
<script src="2_Regression_and_Scaling_files/libs/quarto-html/popper.min.js"></script>
<script src="2_Regression_and_Scaling_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="2_Regression_and_Scaling_files/libs/quarto-html/anchor.min.js"></script>
<link href="2_Regression_and_Scaling_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="2_Regression_and_Scaling_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="2_Regression_and_Scaling_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="2_Regression_and_Scaling_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="2_Regression_and_Scaling_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#turning-words-into-a-document-feature-matrix" id="toc-turning-words-into-a-document-feature-matrix" class="nav-link" data-scroll-target="#turning-words-into-a-document-feature-matrix">Turning words into a document-feature-matrix</a></li>
  <li><a href="#scaling" id="toc-scaling" class="nav-link" data-scroll-target="#scaling">Scaling</a>
  <ul class="collapse">
  <li><a href="#wordscores---supervised-scaling" id="toc-wordscores---supervised-scaling" class="nav-link" data-scroll-target="#wordscores---supervised-scaling">wordscores - supervised scaling</a></li>
  <li><a href="#wordfish---unsupervised-scaling" id="toc-wordfish---unsupervised-scaling" class="nav-link" data-scroll-target="#wordfish---unsupervised-scaling">wordfish - unsupervised scaling</a>
  <ul class="collapse">
  <li><a href="#exercise-tasks-scaling" id="toc-exercise-tasks-scaling" class="nav-link" data-scroll-target="#exercise-tasks-scaling">Exercise Tasks: scaling</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#regression" id="toc-regression" class="nav-link" data-scroll-target="#regression">Regression</a>
  <ul class="collapse">
  <li><a href="#exercise-tasks" id="toc-exercise-tasks" class="nav-link" data-scroll-target="#exercise-tasks">Exercise Tasks</a></li>
  </ul></li>
  <li><a href="#wrap-up" id="toc-wrap-up" class="nav-link" data-scroll-target="#wrap-up">Wrap Up</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Workshop Automated Content Analysis</h1>
<p class="subtitle lead">Session 2: Text Scaling and Regression Models</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Johannes B. Gruber </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 6, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The main insight from this workshop should be that in order to analyse text with a computer, we turn the words into numbers, so the computer can understand them. Once this is done, many methods in computational analysis of text are just simple statistics.</p>
</section>
<section id="turning-words-into-a-document-feature-matrix" class="level1">
<h1>Turning words into a document-feature-matrix</h1>
<p>As data source for this session we use <a href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/ZY3RV7">the ParlEE plenary speeches data set</a> of parliamentary speeches from the Harvard dataverse:</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.2     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.2     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.1     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
<p><img src="media/dataset.png" class="img-fluid"></p>
<p>We use the <code>tidytext</code> package in combination with the <code>tidyverse</code> to make the process more visible. (An alternative would be <code>quanteda</code>, which is also a really good package and often faster and with many sensible defaults.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>plenary_speeches_raw <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(<span class="st">"data/ParlEE_AT_plenary_speeches.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>plenary_speeches_raw <span class="sc">|&gt;</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  instance_id       date             agenda speechnumber sentencenumber
1           1 21/01/2009 Beginn der Sitzung            1              1
2           2 21/01/2009 Beginn der Sitzung            1              2
3           3 21/01/2009 Beginn der Sitzung            1              3
4           4 21/01/2009 Beginn der Sitzung            1              4
5           5 21/01/2009 Beginn der Sitzung            1              5
6           6 21/01/2009 Beginn der Sitzung            1              6
          speaker party
1 Barbara Prammer   SPÖ
2 Barbara Prammer   SPÖ
3 Barbara Prammer   SPÖ
4 Barbara Prammer   SPÖ
5 Barbara Prammer   SPÖ
6 Barbara Prammer   SPÖ
                                                                                                  text
1                                                                Guten Morgen, meine Damen und Herren!
2                                                                             Ich eröffne die Sitzung.
3                                               Die Amtlichen Protokolle der 8. und 9. Sitzung vom 10.
4                Dezember 2008 sind in der Parlamentsdirektion aufgelegen und unbeanstandet geblieben.
5 Als verhindert gemeldet sind die Abgeordneten Mag. Muttonen, Praßl, Herbert, Jannach und Dr. Winter.
6                                                                                              Einlauf
      parliament iso3country chair eu policyarea cmp_party
1 AT-Nationalrat         AUS  TRUE  0         12     42320
2 AT-Nationalrat         AUS  TRUE  0         20     42320
3 AT-Nationalrat         AUS  TRUE  0         20     42320
4 AT-Nationalrat         AUS  TRUE  0         20     42320
5 AT-Nationalrat         AUS  TRUE  0         20     42320
6 AT-Nationalrat         AUS  TRUE  0         10     42320</code></pre>
</div>
</div>
<p>Before doing the actual analysis we do some cleaning and preprocessing (as you almost always do). In this case, the speeches are split into sentences, but we want to analyse whole speeches at once in this case.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>plenary_speeches <span class="ot">&lt;-</span> plenary_speeches_raw <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> lubridate<span class="sc">::</span><span class="fu">dmy</span>(date)) <span class="sc">|&gt;</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="st">"2017-11-09"</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>         date <span class="sc">&lt;=</span> <span class="st">"2019-10-22"</span>) <span class="sc">|&gt;</span>  <span class="co"># select XXVI. Gesetzgebungsperiode: 09.11.2017 – 22.10.2019</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date, speechnumber, speaker, agenda, party, chair) <span class="sc">|&gt;</span> <span class="co"># go from sentence to speech level</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">text =</span> <span class="fu">paste</span>(text, <span class="at">collapse =</span> <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">speech_id =</span> <span class="fu">row_number</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For this analysis it makes sense to remove stopwords (words which are used often in texts but only contain little meaning). Keeping the words would obscure some more valuable patterns. This would lead to a high number of more connections that are most likely unimportant to use. Second, keeping stopwords would drive up the computing time. Therefore, we will delete stopwords. Let’s have a look at the off-the-shelf set:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>stopwords<span class="sc">::</span><span class="fu">stopwords</span>(<span class="st">"de"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "aber"      "alle"      "allem"     "allen"     "aller"     "alles"    
  [7] "als"       "also"      "am"        "an"        "ander"     "andere"   
 [13] "anderem"   "anderen"   "anderer"   "anderes"   "anderm"    "andern"   
 [19] "anderr"    "anders"    "auch"      "auf"       "aus"       "bei"      
 [25] "bin"       "bis"       "bist"      "da"        "damit"     "dann"     
 [31] "der"       "den"       "des"       "dem"       "die"       "das"      
 [37] "daß"       "derselbe"  "derselben" "denselben" "desselben" "demselben"
 [43] "dieselbe"  "dieselben" "dasselbe"  "dazu"      "dein"      "deine"    
 [49] "deinem"    "deinen"    "deiner"    "deines"    "denn"      "derer"    
 [55] "dessen"    "dich"      "dir"       "du"        "dies"      "diese"    
 [61] "diesem"    "diesen"    "dieser"    "dieses"    "doch"      "dort"     
 [67] "durch"     "ein"       "eine"      "einem"     "einen"     "einer"    
 [73] "eines"     "einig"     "einige"    "einigem"   "einigen"   "einiger"  
 [79] "einiges"   "einmal"    "er"        "ihn"       "ihm"       "es"       
 [85] "etwas"     "euer"      "eure"      "eurem"     "euren"     "eurer"    
 [91] "eures"     "für"       "gegen"     "gewesen"   "hab"       "habe"     
 [97] "haben"     "hat"       "hatte"     "hatten"    "hier"      "hin"      
[103] "hinter"    "ich"       "mich"      "mir"       "ihr"       "ihre"     
[109] "ihrem"     "ihren"     "ihrer"     "ihres"     "euch"      "im"       
[115] "in"        "indem"     "ins"       "ist"       "jede"      "jedem"    
[121] "jeden"     "jeder"     "jedes"     "jene"      "jenem"     "jenen"    
[127] "jener"     "jenes"     "jetzt"     "kann"      "kein"      "keine"    
[133] "keinem"    "keinen"    "keiner"    "keines"    "können"    "könnte"   
[139] "machen"    "man"       "manche"    "manchem"   "manchen"   "mancher"  
[145] "manches"   "mein"      "meine"     "meinem"    "meinen"    "meiner"   
[151] "meines"    "mit"       "muss"      "musste"    "nach"      "nicht"    
[157] "nichts"    "noch"      "nun"       "nur"       "ob"        "oder"     
[163] "ohne"      "sehr"      "sein"      "seine"     "seinem"    "seinen"   
[169] "seiner"    "seines"    "selbst"    "sich"      "sie"       "ihnen"    
[175] "sind"      "so"        "solche"    "solchem"   "solchen"   "solcher"  
[181] "solches"   "soll"      "sollte"    "sondern"   "sonst"     "über"     
[187] "um"        "und"       "uns"       "unse"      "unsem"     "unsen"    
[193] "unser"     "unses"     "unter"     "viel"      "vom"       "von"      
[199] "vor"       "während"   "war"       "waren"     "warst"     "was"      
[205] "weg"       "weil"      "weiter"    "welche"    "welchem"   "welchen"  
[211] "welcher"   "welches"   "wenn"      "werde"     "werden"    "wie"      
[217] "wieder"    "will"      "wir"       "wird"      "wirst"     "wo"       
[223] "wollen"    "wollte"    "würde"     "würden"    "zu"        "zum"      
[229] "zur"       "zwar"      "zwischen" </code></pre>
</div>
</div>
<p>We also remove numbers and URLs, which are hard to make sense of out of context.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>plenary_speeches_tidy <span class="ot">&lt;-</span> plenary_speeches <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">output =</span> <span class="st">"word"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">input =</span> <span class="st">"text"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">token =</span> <span class="st">"words"</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>word <span class="sc">%in%</span> stopwords<span class="sc">::</span><span class="fu">stopwords</span>(<span class="st">"de"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(word, <span class="st">"[A-z]"</span>)) <span class="co"># remove features that consist only of numbers</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>plenary_speeches_tidy <span class="sc">|&gt;</span> </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
  date       speechnumber speaker     agenda         party chair speech_id word 
  &lt;date&gt;            &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;          &lt;chr&gt; &lt;lgl&gt;     &lt;int&gt; &lt;chr&gt;
1 2017-11-09            1 Doris Bures Beginn der Si… SPÖ   TRUE          1 geeh…
2 2017-11-09            1 Doris Bures Beginn der Si… SPÖ   TRUE          1 damen
3 2017-11-09            1 Doris Bures Beginn der Si… SPÖ   TRUE          1 herr…
4 2017-11-09            1 Doris Bures Beginn der Si… SPÖ   TRUE          1 gemäß
5 2017-11-09            1 Doris Bures Beginn der Si… SPÖ   TRUE          1 abs  
6 2017-11-09            1 Doris Bures Beginn der Si… SPÖ   TRUE          1 gesc…</code></pre>
</div>
</div>
<p>We can now look at the data in a document-feature-matrix, named like this since documents are the rows of the matrix and features (words and other characters) are the columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>plenary_speeches_dfm <span class="ot">&lt;-</span> plenary_speeches_tidy <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(speech_id, word) <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cast_dfm</span>(<span class="at">document =</span> speech_id, <span class="at">term =</span> word, <span class="at">value =</span> n)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>plenary_speeches_dfm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Document-feature matrix of: 14,167 documents, 91,946 features (99.90% sparse) and 0 docvars.
    features
docs abs anlässlich beziehungsweise damen erste eröffne eröffnen führen
   1   1          1               1     1     1       1        1      1
   2   0          0               0     2     1       0        0      0
   3   2          0               0     0     0       0        0      0
   4   1          0               0     0     0       0        0      0
   5   2          0               0     0     0       0        0      0
   6   0          0               0     1     0       0        0      0
    features
docs gedenkworte geehrten
   1           1        1
   2           0        2
   3           0        0
   4           0        0
   5           0        0
   6           0        1
[ reached max_ndoc ... 14,161 more documents, reached max_nfeat ... 91,936 more features ]</code></pre>
</div>
</div>
<p>To check out this corpus a bit we can have a quick look at the most often occurring words:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>top_words <span class="ot">&lt;-</span> plenary_speeches_tidy <span class="sc">|&gt;</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>top_words <span class="sc">|&gt;</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 2
   word            n
   &lt;chr&gt;       &lt;int&gt;
 1 dass        37657
 2 herr        14790
 3 frau        11744
 4 schon        8976
 5 bitte        8936
 6 ja           8871
 7 mehr         8828
 8 österreich   8022
 9 gibt         8005
10 ganz         7729
11 herren       7460
12 damen        7334
13 menschen     6651
14 kollegen     6551
15 geht         6529
16 wort         6197
17 heute        5649
18 sagen        5441
19 immer        5430
20 kolleginnen  5304</code></pre>
</div>
</div>
</section>
<section id="scaling" class="level1">
<h1>Scaling</h1>
<section id="wordscores---supervised-scaling" class="level2">
<h2 class="anchored" data-anchor-id="wordscores---supervised-scaling">wordscores - supervised scaling</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>plenary_parties_dfm <span class="ot">&lt;-</span> plenary_speeches_tidy <span class="sc">|&gt;</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(party, word) <span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>party <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"independent"</span>, <span class="st">"Independent"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cast_dfm</span>(<span class="at">document =</span> party, <span class="at">term =</span> word, <span class="at">value =</span> n)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>plenary_parties_dfm <span class="sc">|&gt;</span> </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  quanteda<span class="sc">::</span><span class="fu">print</span>(<span class="at">max_ndoc =</span> <span class="dv">9</span>, <span class="at">max_nfeat =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Document-feature matrix of: 6 documents, 85,767 features (65.99% sparse) and 0 docvars.
       features
docs    100b 100c 10a 123a 124b 12a 136a 137b 137c 13a 14a 15a 15avereinbarung
  FPÖ      2    2   1    1    2   1    3    3    6   5  10  26               1
  Grüne    0    0   0    0    0   0    0    0    0   0   0   0               0
  JETZT    0    0   0    0    0   2    0    0    0   0   2  10               0
  NEOS     0    0   4    0    0   0    0    0    0   2   0  35               0
  SPÖ      4    4   0    0    2   0    0    0    0   2  11  36               1
  ÖVP     14   14   3    0    0   2    0    0    0   0   1  46               0
       features
docs    16jährige 17a 17x 18jährige 18m 1920er 1930er
  FPÖ           1   2   1         1   1      1      1
  Grüne         0   0   0         0   0      0      1
  JETZT         0   2   0         0   0      0      0
  NEOS          0   0   0         0   0      0      1
  SPÖ           0   0   0         0   0      1      2
  ÖVP           0   5   1         0   0      0      0
[ reached max_nfeat ... 85,747 more features ]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>scores <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>party, <span class="sc">~</span>score,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FPÖ"</span>, <span class="dv">1</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Grüne"</span>, <span class="dv">10</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"JETZT"</span>, <span class="cn">NA</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NEOS"</span>, <span class="cn">NA</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SPÖ"</span>, <span class="cn">NA</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ÖVP"</span>, <span class="cn">NA</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Package version: 3.3.0
Unicode version: 15.0
ICU version: 72.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Parallel computing: 12 of 12 threads used.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>See https://quanteda.io for tutorials and examples.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textplots)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textmodels)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>plenary_parties_ws <span class="ot">&lt;-</span> <span class="fu">textmodel_wordscores</span>(plenary_parties_dfm, </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                                           scores<span class="sc">$</span>score[<span class="fu">match</span>(<span class="fu">docnames</span>(plenary_parties_dfm), scores<span class="sc">$</span>party)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>plenary_parties_scores <span class="ot">&lt;-</span> <span class="fu">predict</span>(plenary_parties_ws)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 45694 features in newdata not used in prediction.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_scale1d</span>(plenary_parties_scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2_Regression_and_Scaling_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_scale1d</span>(plenary_parties_ws, </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">margin =</span> <span class="st">"features"</span>, </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">highlighted =</span> <span class="fu">c</span>(<span class="st">"afrikanern"</span>, <span class="st">"asyllösung"</span>, <span class="st">"russlands"</span>, <span class="st">"österreich"</span>, <span class="st">"menschen"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2_Regression_and_Scaling_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(plenary_parties_ws) <span class="co"># Calculates summary statistics of the plenary_parties_ws object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
textmodel_wordscores.dfm(x = plenary_parties_dfm, y = scores$score[match(docnames(plenary_parties_dfm), 
    scores$party)])

Reference Document Statistics:
      score  total min  max   mean median
FPÖ       1 373111   0 7346 4.3503      0
Grüne    10  16413   0  386 0.1914      0
JETZT    NA 139655   0 2885 1.6283      0
NEOS     NA 196253   0 5149 2.2882      0
SPÖ      NA 440349   0 9073 5.1342      0
ÖVP      NA 448284   0 8918 5.2268      0

Wordscores:
(showing first 30 elements)
           100b            100c             10a            123a            124b 
          1.000           1.000           1.000           1.000           1.000 
            12a            136a            137b            137c             13a 
          1.000           1.000           1.000           1.000           1.000 
            14a             15a 15avereinbarung       16jährige             17a 
          1.000           1.000           1.000           1.000           1.000 
            17x       18jährige             18m          1920er          1930er 
          1.000           1.000           1.000           1.000           9.621 
         1960er          1970er          1980er          1990er       19jährige 
          1.000           1.000           1.000           1.000           1.000 
             1a              1b              1c              1d             1fi 
          1.000           1.000           1.000           1.000           1.000 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>word_scores <span class="ot">&lt;-</span> <span class="fu">coef</span>(plenary_parties_ws) <span class="sc">|&gt;</span> <span class="co"># Creates a vector of coefficients from the plenary_parties_ws object</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"word"</span>) <span class="sc">|&gt;</span> <span class="co"># Converts the vector to a tibble with the rownames set to "word"</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">score =</span> value) <span class="sc">|&gt;</span> <span class="co"># Renames the value column to "score"</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(top_words, <span class="at">by =</span> <span class="st">"word"</span>) <span class="co"># Joins the top_words tibble to the word_scores tibble on the "word" column</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>word_scores  <span class="sc">|&gt;</span>  </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 40,073 × 3
   word       score     n
   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;
 1 dass        5.90 37657
 2 herr        4.64 14790
 3 frau        3.14 11744
 4 schon       4.40  8976
 5 bitte       1.61  8936
 6 ja          5.91  8871
 7 mehr        5.03  8828
 8 österreich  6.45  8022
 9 gibt        5.31  8005
10 ganz        4.28  7729
# ℹ 40,063 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>word_scores <span class="sc">|&gt;</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 40,073 × 3
   word             score     n
   &lt;chr&gt;            &lt;dbl&gt; &lt;int&gt;
 1 1920erund           10     1
 2 a4                  10     3
 3 abdriftende         10     1
 4 abdulaziz           10    10
 5 abendlandes         10     6
 6 abgeordnetenwahl    10     1
 7 abgeputzt           10     1
 8 abgeschlagen        10     3
 9 abgeschreckt        10     1
10 abgesperrt          10     1
# ℹ 40,063 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>word_scores <span class="sc">|&gt;</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 40,073 × 3
   word  score     n
   &lt;chr&gt; &lt;dbl&gt; &lt;int&gt;
 1 100b      1    20
 2 100c      1    20
 3 10a       1     8
 4 123a      1     1
 5 124b      1     4
 6 12a       1     5
 7 136a      1     3
 8 137b      1     3
 9 137c      1     6
10 13a       1    11
# ℹ 40,063 more rows</code></pre>
</div>
</div>
</section>
<section id="wordfish---unsupervised-scaling" class="level2">
<h2 class="anchored" data-anchor-id="wordfish---unsupervised-scaling">wordfish - unsupervised scaling</h2>
<p>Quanteda also allows for unsupervised scaling.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>plenary_parties_wf <span class="ot">&lt;-</span> <span class="fu">textmodel_wordfish</span>(plenary_parties_dfm, <span class="at">sparse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_scale1d</span>(plenary_parties_wf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2_Regression_and_Scaling_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_scale1d</span>(plenary_parties_wf, <span class="at">margin =</span> <span class="st">"features"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2_Regression_and_Scaling_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Wordfish automatically scales all documents according to an underlying latent variable (the beta), which is assumed to correspond to the most interesting dimension in the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>word_fish_scores <span class="ot">&lt;-</span> <span class="fu">coef</span>(plenary_parties_wf)<span class="sc">$</span>features <span class="sc">|&gt;</span> <span class="co"># Creates a vector of coefficients from the plenary_parties_ws object</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"word"</span>) <span class="sc">|&gt;</span> <span class="co"># Converts the vector to a tibble with the rownames set to "word"</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(top_words, <span class="at">by =</span> <span class="st">"word"</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>word_fish_scores <span class="sc">|&gt;</span> </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 85,767 × 4
   word          beta   psi     n
   &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
 1 dass        0.0873  8.60 37657
 2 herr       -0.157   7.59 14790
 3 frau       -0.280   7.29 11744
 4 schon       0.0759  7.19  8976
 5 bitte      -0.891   6.58  8936
 6 ja          0.239   7.24  8871
 7 mehr        0.0631  7.17  8828
 8 österreich -0.0145  6.99  8022
 9 gibt        0.109   7.07  8005
10 ganz        0.0227  7.01  7729
# ℹ 85,757 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>word_fish_scores <span class="sc">|&gt;</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>beta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 85,767 × 4
   word                      beta   psi     n
   &lt;chr&gt;                    &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
 1 kriegsmaterial            6.23 -3.56    10
 2 waffenembargo             5.58 -3.07    11
 3 außenwirtschaftsgesetz    5.49 -3.12     7
 4 kriegsmaterialgesetz      5.49 -3.12    10
 5 pistolen                  5.04 -2.71     7
 6 ankara                    4.89 -2.43     8
 7 false                     4.76 -2.32     8
 8 globalisierungsverlierer  4.76 -2.32     8
 9 bumsti                    4.76 -2.32     8
10 flag                      4.76 -2.32     9
# ℹ 85,757 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>word_fish_scores <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(beta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 85,767 × 4
   word            beta   psi     n
   &lt;chr&gt;          &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
 1 zeugenperson   -6.13 -5.18    32
 2 k.c            -5.70 -4.95    17
 3 fotograf       -5.61 -4.90    16
 4 zeitversetzt   -5.54 -4.20    30
 5 judo           -5.52 -4.86    15
 6 sitzungstag    -5.43 -3.52    52
 7 nationalrätin  -5.43 -4.13    28
 8 weinwirtschaft -5.39 -4.78    14
 9 schülergruppe  -5.20 -4.69    12
10 26a            -5.08 -4.63    11
# ℹ 85,757 more rows</code></pre>
</div>
</div>
<section id="exercise-tasks-scaling" class="level3">
<h3 class="anchored" data-anchor-id="exercise-tasks-scaling">Exercise Tasks: scaling</h3>
<ol type="1">
<li>Load a dataset of your choice into R (e.g., WhatsApp data, the CCS Lab descriptions, the Kaggle Twitter dataset)</li>
<li>Get the most frequent 500 words from your data</li>
<li>Use <code>textmodel_wordfish</code> your data to scale document(groups)</li>
<li>Use <code>textmodel_scores</code> to find proximity of document(groups) in your data, given two “extremes”</li>
</ol>
</section>
</section>
</section>
<section id="regression" class="level1">
<h1>Regression</h1>
<p>In this section, we will use supervised machine learning (SML) to predict continuous values that are associated with text data. SML can be divided into two types</p>
<ul>
<li>A <strong>classification</strong> model predicts a class label or group membership.</li>
<li>A <strong>regression</strong> model predicts a numeric or continuous value.</li>
</ul>
<p>Most people think about classification when they hear SML, but it is actually possible to use standard algorithms that you would usually think of as statistics to predict continuous rather than categorical variables. In the ParlEE dataset, the date comes to mind as something we could try to predict. Let’s have a look:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>plenary_speeches_tidy <span class="sc">|&gt;</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(speech_id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">date =</span> lubridate<span class="sc">::</span><span class="fu">floor_date</span>(date, <span class="st">"months"</span>)) <span class="sc">|&gt;</span> <span class="co"># used to make plot easier to read</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2_Regression_and_Scaling_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To make the variable easier to interpret, we convert the date into days since the first session using a small function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>day_diff <span class="ot">&lt;-</span> <span class="cf">function</span>(dates) {</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  first_date <span class="ot">&lt;-</span> <span class="fu">min</span>(dates)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.integer</span>(dates <span class="sc">-</span> first_date, <span class="at">units =</span> <span class="st">"days"</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co"># let's test this</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="fu">day_diff</span>(<span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2023-01-01"</span>, <span class="st">"2023-02-01"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  0 31</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>plenary_speeches_tidy_mc <span class="ot">&lt;-</span> plenary_speeches_tidy <span class="sc">|&gt;</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">day_nr =</span> <span class="fu">day_diff</span>(date))</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>plenary_speeches_tidy_mc <span class="sc">|&gt;</span> </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(speech_id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(day_nr) <span class="sc">|&gt;</span> </span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> day_nr, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2_Regression_and_Scaling_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It’s not as easy to look at, but will work for our purposes. Next, we need to select some independent variables. I use the 1,000 most prevalent words and turn our long format data into the wide format the regression function expects:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>top_words_chr <span class="ot">&lt;-</span> top_words <span class="sc">|&gt;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1000</span>) <span class="sc">|&gt;</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(word)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>plenary_speeches_tidy_mc_dfm <span class="ot">&lt;-</span> plenary_speeches_tidy_mc <span class="sc">|&gt;</span> </span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(word <span class="sc">%in%</span> top_words_chr) <span class="sc">|&gt;</span> </span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word, speech_id, day_nr) <span class="sc">|&gt;</span> </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> word, <span class="at">values_from =</span> n, <span class="at">values_fill =</span> <span class="dv">0</span>)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>plenary_speeches_tidy_mc_dfm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14,154 × 1,002
   speech_id day_nr     a    ab abgelehnt abgeordnete abgeordneten abgeordneter
       &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt;       &lt;int&gt;        &lt;int&gt;        &lt;int&gt;
 1         7      0     1     0         0           0            1            0
 2        27      0     1     1         0           1            1            0
 3        66      0     2     0         0           0            0            0
 4        69     34    20     0         0           0           18            0
 5        70     34     2     0         0           1            3            0
 6        72     34     2     0         0           0            2            0
 7       132     34     8     0         0           0            7            0
 8       142     34     1     0         0           0            0            0
 9       181     34     1     0         0           0            0            0
10       183     34     2     0         0           0            2            0
# ℹ 14,144 more rows
# ℹ 994 more variables: abkommen &lt;int&gt;, abs &lt;int&gt;, abschaffung &lt;int&gt;,
#   abschließend &lt;int&gt;, absolut &lt;int&gt;, abstimmung &lt;int&gt;,
#   abänderungsantrag &lt;int&gt;, aktion &lt;int&gt;, aktuellen &lt;int&gt;, all &lt;int&gt;,
#   allein &lt;int&gt;, allerdings &lt;int&gt;, andererseits &lt;int&gt;, anfang &lt;int&gt;,
#   anfrage &lt;int&gt;, angenommen &lt;int&gt;, angesprochen &lt;int&gt;, angst &lt;int&gt;,
#   anliegen &lt;int&gt;, anschauen &lt;int&gt;, anspruch &lt;int&gt;, antrag &lt;int&gt;, …</code></pre>
</div>
</div>
<p>This is exactly the same <code>cast_dfm</code> function above, but it produces a normal <code>data.frame</code> instead of a sparse matrix.</p>
<p>The idea of machine learning is to predict some new cases. We can evaluate the performance of a model by removing some cases beforehand and then testing the model against the true value of these test cases.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>training_ids <span class="ot">&lt;-</span> plenary_speeches_tidy_mc_dfm <span class="sc">|&gt;</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="fl">0.8</span>) <span class="sc">|&gt;</span> </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(speech_id)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>training_data <span class="ot">&lt;-</span> plenary_speeches_tidy_mc_dfm <span class="sc">|&gt;</span> </span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(speech_id <span class="sc">%in%</span> training_ids)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> plenary_speeches_tidy_mc_dfm <span class="sc">|&gt;</span> </span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>speech_id <span class="sc">%in%</span> training_ids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We use the normal <code>lm()</code> function on the data with <code>day_nr</code> as dependant and everything else (except speech_id) as independent variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(day_nr <span class="sc">~</span> ., <span class="at">data =</span> <span class="fu">select</span>(training_data, <span class="sc">-</span>speech_id))</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># you can run summary for fun but it will print almost all words</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(model)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One interesting side effect of this is that the coefficients tell us which words can be used to predict an early or late speech:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>coef_df <span class="ot">&lt;-</span> <span class="fu">coef</span>(model) <span class="sc">|&gt;</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"coef"</span>)<span class="sc">|&gt;</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(coef <span class="sc">!=</span> <span class="st">"(Intercept)"</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>coef_df <span class="sc">|&gt;</span> </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,000 × 2
   coef               value
   &lt;chr&gt;              &lt;dbl&gt;
 1 verzichtet         -55.2
 2 nächster           -47.7
 3 strolz             -47.3
 4 folgenden          -40.8
 5 regierungsprogramm -35.3
 6 samt               -34.7
 7 wünscht            -34.4
 8 liste              -33.9
 9 gewissen           -27.0
10 polizei            -27.0
# ℹ 990 more rows</code></pre>
</div>
</div>
<p>Some interesting words that predict earlier tweets are “strolz” and “polizei”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>coef_df <span class="sc">|&gt;</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,000 × 2
   coef           value
   &lt;chr&gt;          &lt;dbl&gt;
 1 mündliche       60.8
 2 gelangt         60.0
 3 schlusswort     59.1
 4 ordnungsgemäß   44.3
 5 berichtigung    43.3
 6 entsprechendes  34.5
 7 hinsichtlich    33.9
 8 steuerreform    32.2
 9 sogleich        30.4
10 gearbeitet      30.1
# ℹ 990 more rows</code></pre>
</div>
</div>
<p>At the other side of the spectrum we see “steuerreform” and “klimaschutz more often.</p>
<p>To evaluate the model, we predict values for day in the test set, using the words of the texts in there and the model. We then plot the predicted values against the true ones:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>test_data_predict <span class="ot">&lt;-</span> test_data <span class="sc">|&gt;</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">day_nr_predict =</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> <span class="fu">select</span>(test_data, <span class="sc">-</span>speech_id)))</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>test_data_predict <span class="sc">|&gt;</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> day_nr, <span class="at">y =</span> day_nr_predict)) <span class="sc">+</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">color =</span> <span class="st">"firebrick"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Truth"</span>,</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Predicted Day"</span>,</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="cn">NULL</span>,</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Predicted and true days for tweets about #IranProtests2022"</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2_Regression_and_Scaling_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can see that the fit is not great, with some negative day values and quite a bit of mis-prediction. But we can still see a trend and that the model is actually predicted something and does not return random results. Given that language does not shift that dramatically over time, this is still quite interesting.</p>
<section id="exercise-tasks" class="level3">
<h3 class="anchored" data-anchor-id="exercise-tasks">Exercise Tasks</h3>
<ol type="1">
<li>In the Iran Tweets data, turn the day since the first tweet into a continuous variable starting with 1</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>iran_tweets <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(<span class="st">"data/iran_tweets.csv.zip"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li><p>Get the top 500 words in the first 10 days of the Iran Tweets data</p></li>
<li><p>Divide the tweets into test and training data</p></li>
<li><p>Run a OLS with the day since the first tweet as dependent variable.</p></li>
<li><p>Use the model to predict the day of the test data.</p></li>
</ol>
</section>
</section>
<section id="wrap-up" class="level1">
<h1>Wrap Up</h1>
<p>I like to put some information about the current session at the end of each quarto document. This way I know which packages I used to render an html file and can potentially reconstruct the same environment, even if the emplyed packages have changed in the meantime. I also use this last chunk to save objects I potentially want to re-use later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.1 (2023-06-16)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: EndeavourOS

Matrix products: default
BLAS:   /usr/lib/libblas.so.3.11.0 
LAPACK: /usr/lib/liblapack.so.3.11.0

locale:
 [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8    
 [5] LC_MONETARY=en_GB.UTF-8    LC_MESSAGES=en_GB.UTF-8   
 [7] LC_PAPER=en_GB.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_GB.UTF-8 LC_IDENTIFICATION=C       

time zone: Europe/Berlin
tzcode source: system (glibc)

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] quanteda.textmodels_0.9.6 quanteda.textplots_0.94.3
 [3] quanteda_3.3.0            tidytext_0.4.1           
 [5] dataverse_0.3.13          lubridate_1.9.2          
 [7] forcats_1.0.0             stringr_1.5.0            
 [9] dplyr_1.1.2               purrr_1.0.1              
[11] readr_2.1.4               tidyr_1.3.0              
[13] tibble_3.2.1              ggplot2_3.4.2            
[15] tidyverse_2.0.0          

loaded via a namespace (and not attached):
 [1] fastmatch_1.1-3    shape_1.4.6        gtable_0.3.3       xfun_0.39         
 [5] htmlwidgets_1.6.2  lattice_0.21-8     tzdb_0.4.0         vctrs_0.6.3       
 [9] tools_4.3.1        generics_0.1.3     curl_5.0.1         fansi_1.0.4       
[13] janeaustenr_1.0.0  pkgconfig_2.0.3    tokenizers_0.3.0   Matrix_1.5-4.1    
[17] data.table_1.14.8  readxl_1.4.2       RcppParallel_5.1.7 lifecycle_1.0.3   
[21] farver_2.1.1       compiler_4.3.1     munsell_0.5.0      codetools_0.2-19  
[25] SparseM_1.81       SnowballC_0.7.1    htmltools_0.5.5    glmnet_4.1-7      
[29] yaml_2.3.7         pillar_1.9.0       iterators_1.0.14   foreach_1.5.2     
[33] nlme_3.1-162       stopwords_2.3      tidyselect_1.2.0   zip_2.3.0         
[37] digest_0.6.32      stringi_1.7.12     labeling_0.4.2     splines_4.3.1     
[41] rio_0.5.29         fastmap_1.1.1      grid_4.3.1         colorspace_2.1-0  
[45] cli_3.6.1          magrittr_2.0.3     survival_3.5-5     utf8_1.2.3        
[49] foreign_0.8-84     withr_2.5.0        scales_1.2.1       timechange_0.2.0  
[53] rmarkdown_2.21     httr_1.4.6         cellranger_1.1.0   hms_1.1.3         
[57] openxlsx_4.2.5.2   evaluate_0.20      knitr_1.42         haven_2.5.2       
[61] mgcv_1.8-42        LiblineaR_2.10-22  rlang_1.1.1        Rcpp_1.0.10       
[65] glue_1.6.2         jsonlite_1.8.7     R6_2.5.1          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save data for later</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(plenary_speeches_tidy, <span class="st">"data/plenary_speeches_tidy.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>